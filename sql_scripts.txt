-- ================================================
-- Flyway Migration: Create assets table
-- Database: PostgreSQL
-- ================================================

CREATE TABLE IF NOT EXISTS assets (
    id BIGSERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    value64 TEXT NOT NULL, -- Base64-encoded string
    company VARCHAR(255),
    created_at TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL,
    updated_at TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL,
    type VARCHAR(50) NOT NULL CHECK (type IN ('logo', 'icon'))
);

-- ================================================
-- Trigger: Automatically update 'updated_at' column
-- ================================================

CREATE OR REPLACE FUNCTION update_assets_timestamp()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_assets_updated_at
BEFORE UPDATE ON assets
FOR EACH ROW
EXECUTE FUNCTION update_assets_timestamp();

INSERT INTO assets (name, value64, company, type)
VALUES (
    'Main Logo',
    'PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzNDEuMTIgMTI3LjQxIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6bm9uZTtzdHJva2U6I2Y1ZTJkYTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLXdpZHRoOjJweDt9LmNscy0ye2ZpbGw6I2Y1ZTJkYTt9PC9zdHlsZT48L2RlZnM+PGcgaWQ9IkxheWVyXzIiIGRhdGEtbmFtZT0iTGF5ZXIgMiI+PGcgaWQ9IlRZUE8iPjxwYXRoIGNsYXNzPSJjbHMtMSIgZD0iTTcyLjEzLDE1LjYySDM2LjU3bTI4My41NywwSDE1OS44MU03Mi4xMyw5NS41NSwzNi41NywxNS42MiwxLDk1LjU1bTAsMEgzMDAuMTZNMjk4LjY4LDguMzFBNy4zMSw3LjMxLDAsMSwxLDI5MS4zNywxLDcuMzEsNy4zMSwwLDAsMSwyOTguNjgsOC4zMVpNMTU5LjgxLDU1LjU4SDIzMW0tMjEyLjE3LDBINzIuMTNtMjQ4LTQwYTIwLDIwLDAsMSwwLDAsNDAsMjAsMjAsMCwwLDEsMCw0MGgtMjBtLTguNzktNzkuOTNWOTUuNTVtLTExLjEyLDBMMjU1LjYsNjQuOTJhMjQuNjUsMjQuNjUsMCwxLDAsMC00OS4zSDIzMVY5NS41NW0tNzEuMTQsMFYxNS42MWExNC42MSwxNC42MSwwLDAsMC0yOS4yMiwwVjk1LjU1bTAsMFYxNS42MWExNC42MiwxNC42MiwwLDAsMC0yOS4yMywwVjk1LjU1bTAsMFYxNS42MWExNC42MiwxNC42MiwwLDAsMC0yOS4yMywwVjk1LjU1bTE1OC44MiwwTDE5NS4zOCwxNS42MiwxNTkuODEsOTUuNTUiLz48cGF0aCBjbGFzcz0iY2xzLTIiIGQ9Ik04Ny45NCwxMTMuNjRhOC4yMiw4LjIyLDAsMCwwLTIuMTgtMS41NSw3LjE2LDcuMTYsMCwwLDAtMi44OC0uNjUsNi44OSw2Ljg5LDAsMCwwLDAsMTMuNzcsNyw3LDAsMCwwLDMuMTEtLjc4LDcuNyw3LjcsMCwwLDAsMS45My0xLjR2Mi4zYTguNzIsOC43MiwwLDAsMS01LDEuNjMsOC42NCw4LjY0LDAsMSwxLC4xLTE3LjI4LDcuOSw3LjksMCwwLDEsNC45NCwxLjY2WiIvPjxwYXRoIGNsYXNzPSJjbHMtMiIgZD0iTTk1LjE1LDExOC4zMmE4LjY5LDguNjksMCwxLDEsOC42OSw4LjY0QTguNTMsOC41MywwLDAsMSw5NS4xNSwxMTguMzJabTEuOSwwYTYuNzksNi43OSwwLDEsMCw2Ljc5LTYuODhBNi44Miw2LjgyLDAsMCwwLDk3LjA1LDExOC4zMloiLz48cGF0aCBjbGFzcz0iY2xzLTIiIGQ9Ik0xMjEuMTksMTI2LjY2di0xNy40bDEzLDEzLjY0VjExMGgxLjg2djE3LjQ1bC0xMy0xMy42NXYxMi45WiIvPjxwYXRoIGNsYXNzPSJjbHMtMiIgZD0iTTE1My4wOSwxMTMuMjZhNCw0LDAsMCwwLTEtMS4yNSwzLDMsMCwwLDAtMS44OC0uNTcsMi41NiwyLjU2LDAsMCwwLTIuODEsMi41NywxLjc3LDEuNzcsMCwwLDAsLjYzLDEuNDYsNS41OSw1LjU5LDAsMCwwLDEuNzUsMWwxLjYxLjdBOC4yMyw4LjIzLDAsMCwxLDE1NCwxMTguOGE0LDQsMCwwLDEsMS4yMSwzLDUuMzcsNS4zNywwLDAsMS04LjkyLDMuNzgsNi4xMiw2LjEyLDAsMCwxLTEuNTUtM2wxLjgtLjVhNCw0LDAsMCwwLDEsMi4xMywzLjIsMy4yLDAsMCwwLDIuNDEuOTMsMy4xNiwzLjE2LDAsMCwwLDMuMzUtMy4zMSwyLjQ4LDIuNDgsMCwwLDAtLjgyLTIsNy4zNSw3LjM1LDAsMCwwLTItMS4xNWwtMS41LS43YTcuMzMsNy4zMywwLDAsMS0yLjIzLTEuMzgsMy40OSwzLjQ5LDAsMCwxLTEuMTUtMi43M2MwLTIuNTgsMi00LjMxLDQuNjgtNC4zMWE0LjUxLDQuNTEsMCwwLDEsMi42OC43NSw1LDUsMCwwLDEsMS42MywxLjg2WiIvPjxwYXRoIGNsYXNzPSJjbHMtMiIgZD0iTTE2NS43MSwxMjAuMmMwLDEuNCwwLDIuOTMsMS4zMyw0LjA2YTQuNDcsNC40NywwLDAsMCw1LjUxLDBjMS4zMy0xLjEzLDEuMzMtMi42NiwxLjMzLTQuMDZWMTEwaDEuODVWMTIwLjdhNi40Nyw2LjQ3LDAsMCwxLTEsNCw2LjQzLDYuNDMsMCwwLDEtOS43NywwLDYuNDcsNi40NywwLDAsMS0xLTRWMTEwaDEuODVaIi8+PHBhdGggY2xhc3M9ImNscy0yIiBkPSJNMTg3LjE1LDExMHYxNWg0LjYxdjEuNzVIMTg1LjNWMTEwWiIvPjxwYXRoIGNsYXNzPSJjbHMtMiIgZD0iTTIwMy4xLDExMS43MXYxNWgtMS44NXYtMTVoLTQuMDZWMTEwaDEwdjEuNzVaIi8+PHBhdGggY2xhc3M9ImNscy0yIiBkPSJNMjE2Ljc4LDExMHYxNi43aC0xLjg2VjExMFoiLz48cGF0aCBjbGFzcz0iY2xzLTIiIGQ9Ik0yMjYuMzIsMTI2LjY2di0xNy40bDEzLDEzLjY0VjExMGgxLjg1djE3LjQ1bC0xMy0xMy42NXYxMi45WiIvPjxwYXRoIGNsYXNzPSJjbHMtMiIgZD0iTTI1OS4zNywxMTguMjdoN3YuNGE5LjIyLDkuMjIsMCwwLDEtMS42LDUuMjksNy41MSw3LjUxLDAsMCwxLTYuMjEsMyw4LjY0LDguNjQsMCwxLDEsLjA1LTE3LjI4LDguMjksOC4yOSwwLDAsMSw1LjExLDEuNjYsMTAuMjIsMTAuMjIsMCwwLDEsMS45MywybC0xLjM4LDEuMjZhOC44Nyw4Ljg3LDAsMCwwLTEuNTgtMS43Myw2LjEzLDYuMTMsMCwwLDAtNC4wNi0xLjQsNi44OSw2Ljg5LDAsMCwwLDAsMTMuNzcsNS44MSw1LjgxLDAsMCwwLDUuMTEtMi44MSw1LjIzLDUuMjMsMCwwLDAsLjY4LTIuMzhoLTVaIi8+PHBhdGggY2xhc3M9ImNscy0yIiBkPSJNMjg1Ljg2LDEyMC44NWExLjc4LDEuNzgsMCwxLDAtMS43Ny0xLjc3LDEuNzgsMS43OCwwLDAsMCwxLjc3LDEuNzciLz48cGF0aCBjbGFzcz0iY2xzLTIiIGQ9Ik01NS4yNiwxMjAuODVhMS43OCwxLjc4LDAsMSwwLTEuNzctMS43NywxLjc4LDEuNzgsMCwwLDAsMS43NywxLjc3Ii8+PC9nPjwvZz48L3N2Zz4=',  -- your Base64-encoded value here
    'Amaris',
    'logo'
)
RETURNING id;
