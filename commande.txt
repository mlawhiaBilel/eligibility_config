"reseau interne pour inter connecter les contenaires"
docker network create eligibility-network

"config db postgres {recommanded psql (PostgreSQL) 17.5 (Debian 17.5-1.pgdg110+1)"}
docker run -d --name eligibility-db --network eligibility-network -e POSTGRES_BD=eligibility -e POSTGRES_USER=eligibility -e POSTGRES_PASSWORD=eligibility -p 5432:5432 -v eligibility_data:/var/lib/postgresql/data postgres:17

"create db for keycloak container"
docker exec -it eligibility-db psql -U eligibility -d postgres -c "CREATE DATABASE keycloak OWNER eligibility;"

"creation of keycloak container"
docker run -d --name keycloak --network eligibility-network -e KEYCLOAK_ADMIN=eligibility -e KEYCLOAK_ADMIN_PASSWORD=eligibility -e KC_DB=postgres -e KC_DB_URL=jdbc:postgresql://eligibility-db:5432/keycloak -e KC_DB_USERNAME=eligibility -e KC_DB_PASSWORD=eligibility -p 8888:8080 -v keycloak_data:/opt/keycloak/data keycloak/keycloak:latest start-dev

"fixing temp admin removed"
after doing: docker exec -it keycloak bash => after that excute ( newadmin pwd 123)
export ADMIN_PASS=123
/opt/keycloak/bin/kc.sh bootstrap-admin user --username newadmin --password:env ADMIN_PASS

(adding custom login page)
/opt/keycloak/themes/eligibility/
â”œâ”€â”€ theme.properties
â””â”€â”€ login/
    â”œâ”€â”€ login.ftl
    â”œâ”€â”€ resources/
    â”‚   â””â”€â”€ img/
    â”‚       â””â”€â”€ mantu.png
    â””â”€â”€ messages/
        â”œâ”€â”€ messages_en.properties
        â”œâ”€â”€ messages_fr.properties
        â””â”€â”€ messages_ar.properties


(theme.properties content)
parent=keycloak
import=common/keycloak
styles=

---------------------------------------------------------------------------------------------------

(Adapter pour keycloack cotÃ© angular)
npm i keycloak-angular@^16 keycloak-js@^25

---------------------------------------------------------------------------------------------------

"installing multilang"
npm install @ngx-translate/core @ngx-translate/http-loader

---------------------------------------------------------------------------------------------------

"adding Consul Discovery"
docker run -d --name=consul-server --network eligibility-network -p 8500:8500 -p 8600:8600/udp -v data_consul:/bitnami/consul -e CONSUL_SERVER_REJOIN_AGE_MAX="0s" hashicorp/consul:1.22
with restat auto option
docker run -d --name=consul-server --network=eligibility-network -p 8500:8500 -p 8600:8600/udp -v data_consul:/consul/data -e CONSUL_BIND_INTERFACE=eth0 --restart unless-stopped hashicorp/consul:1.22

------------------------------------------------------------------------------------------------------

"for Vault choosing Mode"

Development Mode:

Ephemeral - data gone when container stops

Auto-unsealed - ready to use immediately

Pre-configured root token ("root")

HTTP access from host machine

Insecure - for testing only

Production Mode:

Persistent data (volumes)

Manual unsealing required

No pre-configured credentials

Network isolated (internal network)

Secure - requires proper configuration

"starting container Vault"

Perfect ðŸ‘‡ concise, stable, production-style.

---

cat > vault/config/vault.hcl << 'EOF'
storage "file" {
  path = "/vault/data"
}

listener "tcp" {
  address     = "0.0.0.0:8400"
  tls_disable = 1
}

api_addr     = "http://127.0.0.1:8400"
cluster_addr = "https://127.0.0.1:8401"

ui            = true
disable_mlock = true
EOF


docker run -d \
  --name vault-prod \
  --network eligibility-network \
  -p 8200:8400 \
  --cap-add=IPC_LOCK \
  -v $(pwd)/vault/config:/vault/config \
  -v vault_data:/vault/data \
  -v vault_logs:/vault/logs \
  --entrypoint vault \
  hashicorp/vault:latest server -config=/vault/config/vault.hcl

### âš™ï¸ **Var meanings (super short)**

* **`VAULT_ADDR`** â†’ base URL Vault listens on.
* **`VAULT_API_ADDR`** â†’ real public URL used by UI & redirects.
* **`--cap-add=IPC_LOCK`** â†’ lets Vault lock memory (no secrets swapped).
* **`-v ...`** â†’ persistent data, config, logs, TLS.
* **`-p ...`** â†’ expose UI/API ports (8200 UI/API, 8201 cluster).
* **`-config`** â†’ main Vault config (with seal, listener, storage).

âœ… Both support Vault UI (`http://127.0.0.1:8200/ui` or `https://vault.example.com:8200/ui`).

The auto-unseal itself isnâ€™t in the Docker command.
It lives inside vault/config/vault.hcl â€” thatâ€™s where you put:

seal "azurekeyvault" {
  tenant_id     = "<tenant_id>"
  client_id     = "<appId>"
  client_secret = "<password>"
  vault_name    = "<vault-kv>"
  key_name      = "<vault-key>"
}

--------------------------------------------------------------


So:

Local cmd â†’ same image, same run, but vault.hcl has no seal block â†’ manual unseal.

Azure cmd â†’ uses a vault.hcl with that seal "azurekeyvault" stanza â†’ auto-unseal.

seal "azurekeyvault" {
  tenant_id     = "<tenant_id>"
  client_id     = "<appId>"
  client_secret = "<password>"
  vault_name    = "<vault-kv>"
  key_name      = "<vault-key>"
}










































































 

